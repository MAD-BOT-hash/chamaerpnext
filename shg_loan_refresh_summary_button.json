{
  "doctype": "Client Script",
  "dt": "SHG Loan",
  "view": "Form",
  "enabled": 1,
  "script": "frappe.ui.form.on('SHG Loan', {\n  refresh(frm) {\n    if (!frm.doc.__islocal) {\n      frm.add_custom_button('ðŸ”„ Refresh Summary', async () => {\n        try {\n          frm.dashboard.set_headline(__('Refreshing repayment summary...'));\n          const r = await frappe.call({\n            method: 'shg_loan_refresh_summary',\n            args: { name: frm.doc.name }\n          });\n          const v = (r && r.message) || {};\n          // Push values to the form\n          frm.set_value('monthly_installment', v.monthly_installment || 0);\n          frm.set_value('total_payable', v.total_payable || 0);\n          frm.set_value('balance_amount', v.balance_amount || 0);\n          frm.set_value('total_repaid', v.total_repaid || 0);\n          frm.set_value('overdue_amount', v.overdue_amount || 0);\n          await frm.save();\n          frm.refresh_fields(['monthly_installment','total_payable','balance_amount','total_repaid','overdue_amount']);\n          frm.dashboard.set_headline(__('âœ… Repayment summary refreshed'));\n        } catch (e) {\n          console.error(e);\n          frappe.msgprint({\n            title: __('Refresh Summary Error'),\n            message: __('Failed to refresh repayment summary. Check error log.'),\n            indicator: 'red'\n          });\n        }\n      });\n    }\n  }\n});"
}